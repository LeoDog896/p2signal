var qe=Object.defineProperty;var Ue=Object.getOwnPropertySymbols;var Ke=Object.prototype.hasOwnProperty,Ge=Object.prototype.propertyIsEnumerable;var He=(n,e,t)=>e in n?qe(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t,ye=(n,e)=>{for(var t in e||(e={}))Ke.call(e,t)&&He(n,t,e[t]);if(Ue)for(var t of Ue(e))Ge.call(e,t)&&He(n,t,e[t]);return n};import{S as Qe,i as We,s as Xe,e as c,t as C,c as u,a as b,h as T,d as m,g as Ie,J as r,j as Ve,k as S,m as I,M as V,b as Se,K as D,L as P,n as je,N as Ye,O as xe}from"../../chunks/index-b3b7356b.js";function $e(){const n={};return{on:(e,t)=>n[e]=t,trigger:(e,...t)=>{var a;return(a=n[e])==null?void 0:a.call(n,...t)}}}const et=`v=0\r
`,tt=`\r
a=mid:0\r
a=sctp-port:5000\r
a=max-message-size:262144\r
`;function nt(n){return n.split(`\r
`).map(e=>{if(e=="v=0"||e=="a=max-message-size:262144"||e=="a=sctp-port:5000"||e=="a=mid:0")return"";if(e.includes("a=fingerprint")){const t=e.match(/(?<=fingerprint:sha-256 )([0-Z:]+)/g);return t?`f=${t[0].replaceAll(":","")}`:void 0}return e}).filter(e=>e).join("")}function rt(n){return et+n.split(/(?=\w=)/g).map(e=>{if(e.includes("f=")){const t=e.match(/([0-Z:]+)/g);if(!t)throw Error("Could not find fingerprint");return`a=fingerprint:sha-256 ${[...t[0].matchAll(/[0-9A-Z]{2}/g)].join(":")}`}return e}).join(`\r
`)+tt}function at(n){return(n.type=="answer"?"A":"O")+nt(n.sdp)}function Je(n){return{type:n.charAt(0)=="A"?"answer":"offer",sdp:rt(n.substring(1))}}function ot(n,e,t,a){return new Promise(d=>{const g=v=>{t(v)&&(d(v),n.removeEventListener(e.toString(),g))};n.addEventListener(e.toString(),g,a)})}function st(n,e,t,a){return ot(n,e,t,a)}const Ze=n=>new Promise(e=>{n.addEventListener("icecandidate",({candidate:t})=>{t==null&&n.localDescription!==null&&e(at(n.localDescription))})});async function ze(n,e){var g,v;const t=(v=(g=e==null?void 0:e.iceServers)==null?void 0:g.map(i=>typeof i=="string"?{urls:i}:i))!=null?v:[{urls:"stun:stun.l.google.com:19302"}],a=new RTCPeerConnection({iceServers:t}),d=$e();if(a.addEventListener("connectionstatechange",()=>{a.connectionState==="disconnected"?d.trigger("disconnect"):a.connectionState==="failed"&&d.trigger("error",new Error("Connection failed."))}),n=="offerer"){const i=a.createDataChannel("init"),s=await a.createOffer();await a.setLocalDescription(s);const l=await Ze(a);i.addEventListener("message",({data:h})=>{const{type:p,content:N}=JSON.parse(h);d.trigger(p,N)});const O=st(a,"connectionstatechange",()=>a.connectionState==="connected");return ye({type:"offerer",connection:a,offer:s,description:l,datachannel:i,async connect(h){await a.setRemoteDescription(Je(h)),d.trigger("connect",i),await O}},d)}return a.addEventListener("datachannel",({channel:i})=>{d.trigger("connect",i),i.addEventListener("message",({data:s})=>{const{type:l,content:O}=JSON.parse(s);d.trigger(l,O)})}),ye({type:"answerer",connection:a,async connect(i){return await a.setRemoteDescription(Je(i)),await a.setLocalDescription(await a.createAnswer()),await Ze(a)}},d)}function Fe(n,e,t){const a=n.slice();return a[20]=e[t].author,a[21]=e[t].message,a}function Me(n){let e,t=n[20]+"",a,d,g=n[21]+"",v,i;return{c(){e=c("span"),a=C(t),d=C(": "),v=C(g),i=c("br")},l(s){e=u(s,"SPAN",{});var l=b(e);a=T(l,t),d=T(l,": "),v=T(l,g),l.forEach(m),i=u(s,"BR",{})},m(s,l){Ie(s,e,l),r(e,a),r(e,d),r(e,v),Ie(s,i,l)},p(s,l){l&1&&t!==(t=s[20]+"")&&Ve(a,t),l&1&&g!==(g=s[21]+"")&&Ve(v,g)},d(s){s&&m(e),s&&m(i)}}}function lt(n){let e,t,a,d,g,v,i,s,l,O,h,p,N,K,G,L,Q,W,X,j,Y,te,E,ae,oe,U,se,ne,le,w,x,ie,ce,J,ue,fe,H,de,re,he,$,pe,_e,Z,ve,k,z,ge,me,F,be,R,Ee,Oe,M=n[0],y=[];for(let o=0;o<M.length;o+=1)y[o]=Me(Fe(n,M,o));return{c(){e=c("div"),t=c("div"),a=c("h3"),d=C("Create or join a room?"),g=S(),v=c("button"),i=C("BOB: Create"),s=S(),l=c("button"),O=C("ALICE: Join"),h=S(),p=c("div"),N=c("h3"),K=C("BOB: Send your local offer to ALICE"),G=S(),L=c("input"),Q=S(),W=c("br"),X=S(),j=c("h3"),Y=C('Then, paste the "answer" you received'),te=S(),E=c("input"),ae=c("br"),oe=S(),U=c("button"),se=C("Okay, I pasted it."),le=S(),w=c("div"),x=c("h3"),ie=C('ALICE: Paste the "offer" you received'),ce=S(),J=c("input"),ue=c("br"),fe=S(),H=c("button"),de=C("Okay, I pasted it."),he=S(),$=c("h3"),pe=C("Then, send your local answer to BOB"),_e=S(),Z=c("input"),ve=S(),k=c("div"),z=c("h1"),ge=C("Chat"),me=S(),F=c("div");for(let o=0;o<y.length;o+=1)y[o].c();be=S(),R=c("input"),this.h()},l(o){e=u(o,"DIV",{class:!0});var f=b(e);t=u(f,"DIV",{});var _=b(t);a=u(_,"H3",{});var ee=b(a);d=T(ee,"Create or join a room?"),ee.forEach(m),g=I(_),v=u(_,"BUTTON",{});var Be=b(v);i=T(Be,"BOB: Create"),Be.forEach(m),s=I(_),l=u(_,"BUTTON",{});var Ce=b(l);O=T(Ce,"ALICE: Join"),Ce.forEach(m),_.forEach(m),h=I(f),p=u(f,"DIV",{});var B=b(p);N=u(B,"H3",{});var Te=b(N);K=T(Te,"BOB: Send your local offer to ALICE"),Te.forEach(m),G=I(B),L=u(B,"INPUT",{}),Q=I(B),W=u(B,"BR",{}),X=I(B),j=u(B,"H3",{});var ke=b(j);Y=T(ke,'Then, paste the "answer" you received'),ke.forEach(m),te=I(B),E=u(B,"INPUT",{}),ae=u(B,"BR",{}),oe=I(B),U=u(B,"BUTTON",{});var Ae=b(U);se=T(Ae,"Okay, I pasted it."),Ae.forEach(m),B.forEach(m),le=I(f),w=u(f,"DIV",{});var A=b(w);x=u(A,"H3",{});var Le=b(x);ie=T(Le,'ALICE: Paste the "offer" you received'),Le.forEach(m),ce=I(A),J=u(A,"INPUT",{}),ue=u(A,"BR",{}),fe=I(A),H=u(A,"BUTTON",{});var De=b(H);de=T(De,"Okay, I pasted it."),De.forEach(m),he=I(A),$=u(A,"H3",{});var Pe=b($);pe=T(Pe,"Then, send your local answer to BOB"),Pe.forEach(m),_e=I(A),Z=u(A,"INPUT",{}),A.forEach(m),ve=I(f),k=u(f,"DIV",{});var q=b(k);z=u(q,"H1",{class:!0});var Ne=b(z);ge=T(Ne,"Chat"),Ne.forEach(m),me=I(q),F=u(q,"DIV",{});var Re=b(F);for(let we=0;we<y.length;we+=1)y[we].l(Re);Re.forEach(m),be=I(q),R=u(q,"INPUT",{placeholder:!0}),q.forEach(m),f.forEach(m),this.h()},h(){V(t,"hidden",n[6]!="create"),L.readOnly=!0,U.disabled=ne=n[4]=="",V(p,"hidden",n[6]!="bob"),H.disabled=re=n[3]=="",V(w,"hidden",n[6]!="alice"),Se(z,"class","text-2xl"),Se(R,"placeholder","Send a message"),V(k,"hidden",n[6]!="chat"),Se(e,"class","m-8")},m(o,f){Ie(o,e,f),r(e,t),r(t,a),r(a,d),r(t,g),r(t,v),r(v,i),r(t,s),r(t,l),r(l,O),r(e,h),r(e,p),r(p,N),r(N,K),r(p,G),r(p,L),D(L,n[1]),r(p,Q),r(p,W),r(p,X),r(p,j),r(j,Y),r(p,te),r(p,E),D(E,n[4]),r(p,ae),r(p,oe),r(p,U),r(U,se),r(e,le),r(e,w),r(w,x),r(x,ie),r(w,ce),r(w,J),D(J,n[3]),r(w,ue),r(w,fe),r(w,H),r(H,de),r(w,he),r(w,$),r($,pe),r(w,_e),r(w,Z),D(Z,n[2]),r(e,ve),r(e,k),r(k,z),r(z,ge),r(k,me),r(k,F);for(let _=0;_<y.length;_+=1)y[_].m(F,null);r(k,be),r(k,R),D(R,n[5]),Ee||(Oe=[P(v,"click",n[9]),P(l,"click",n[10]),P(L,"input",n[11]),P(E,"input",n[12]),P(U,"click",n[13]),P(J,"input",n[14]),P(H,"click",n[15]),P(Z,"input",n[16]),P(R,"input",n[17]),P(R,"keypress",n[18])],Ee=!0)},p(o,[f]){if(f&64&&V(t,"hidden",o[6]!="create"),f&2&&L.value!==o[1]&&D(L,o[1]),f&16&&E.value!==o[4]&&D(E,o[4]),f&16&&ne!==(ne=o[4]=="")&&(U.disabled=ne),f&64&&V(p,"hidden",o[6]!="bob"),f&8&&J.value!==o[3]&&D(J,o[3]),f&8&&re!==(re=o[3]=="")&&(H.disabled=re),f&4&&Z.value!==o[2]&&D(Z,o[2]),f&64&&V(w,"hidden",o[6]!="alice"),f&1){M=o[0];let _;for(_=0;_<M.length;_+=1){const ee=Fe(o,M,_);y[_]?y[_].p(ee,f):(y[_]=Me(ee),y[_].c(),y[_].m(F,null))}for(;_<y.length;_+=1)y[_].d(1);y.length=M.length}f&32&&R.value!==o[5]&&D(R,o[5]),f&64&&V(k,"hidden",o[6]!="chat")},i:je,o:je,d(o){o&&m(e),Ye(y,o),Ee=!1,xe(Oe)}}}function it(n,e,t){let a=[],d="",g="",v="",i="",s="",l="create",O=null,h=null;function p(){!h||(h.on("connect",E=>{t(6,l="chat"),t(7,O=E)}),h.on("message",E=>t(0,a=[...a,{author:"them",message:E}])),h.on("disconnect",()=>{t(6,l="create"),t(7,O=null),t(8,h=null)}))}async function N(){t(6,l="bob"),t(8,h=await ze("offerer")),t(1,d=h.description),p()}async function K(){t(6,l="alice"),t(8,h=await ze("answerer")),p()}function G(){d=this.value,t(1,d)}function L(){i=this.value,t(4,i)}const Q=()=>h==null?void 0:h.connect(i);function W(){v=this.value,t(3,v)}const X=async()=>{var E;t(2,g=(E=await(h==null?void 0:h.connect(v)))!=null?E:"")};function j(){g=this.value,t(2,g)}function Y(){s=this.value,t(5,s)}return[a,d,g,v,i,s,l,O,h,N,K,G,L,Q,W,X,j,Y,E=>{E.key=="Enter"&&s&&(O==null||O.send(s),t(0,a=[...a,{author:"us",message:s}]),t(5,s=""))}]}class ft extends Qe{constructor(e){super(),We(this,e,it,lt,Xe,{})}}export{ft as default};
